!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("ngx-localstorage",["exports","@angular/core","rxjs","rxjs/operators"],t):t(e["ngx-localstorage"]={},e.ng.core,e.rxjs,e.rxjs.operators)}(this,function(e,o,n,l){"use strict";var t=function(){function e(e){e&&(this._prefix=e.prefix||this._prefix,this._allowNull=e.allowNull||this._allowNull)}return e.prototype.count=function(){return new Promise(function(e,t){try{e(localStorage.length)}catch(r){t(r)}})},e.prototype.getKey=function(n){return new Promise(function(e,t){n<0&&t(new Error("index has to be 0 or greater"));try{e(localStorage.key(n))}catch(r){t(r)}})},e.prototype.set=function(n,o,i){var l=this;return new Promise(function(e,t){try{if(!l._allowNull&&(l._allowNull||"null"===o||null===o||o===undefined))return l.remove(n,i);localStorage.setItem((i||l._prefix)+"_"+n,o),e(!0)}catch(r){t(r)}})},e.prototype.get=function(n,o){var i=this;return new Promise(function(e,t){try{e(localStorage.getItem((o||i._prefix)+"_"+n))}catch(r){t(r)}})},e.prototype.remove=function(n,o){var i=this;return new Promise(function(e,t){try{localStorage.removeItem((o||i._prefix)+"_"+n),e(!0)}catch(r){t(r)}})},e.prototype.clear=function(){return new Promise(function(e,t){try{localStorage.clear(),e(!0)}catch(r){t(r)}})},e}(),i=function(e,t,r,n){for(var o=e.length-1,i=0;i<o;++i){var l=e[i];l in r||(r[l]={}),r=r[l]}r[e[o]]=(!t||"string"==typeof t&&"false"===t)&&n?n():t},r=!0,a="ngx_local_storage",s=new o.InjectionToken("moduleConfig"),u=function(){function e(e){e&&(this._prefix=e.prefix||a,this._allowNull=e.allowNull||r),this._promisable=new t({allowNull:this._allowNull,prefix:this._prefix})}return e.prototype.asPromisable=function(){return this._promisable},e.prototype.count=function(){try{return localStorage.length}catch(e){console.error(e)}},e.prototype.getKey=function(e){e<0&&console.error(new Error("index has to be 0 or greater"));try{return localStorage.key(e)}catch(t){console.error(t)}},e.prototype.set=function(e,t,r){this._allowNull||!this._allowNull&&"null"!==t&&null!==t&&t!==undefined?localStorage.setItem((r||this._prefix)+"_"+e,t):this.remove(e,r)},e.prototype.get=function(e,t){try{return localStorage.getItem((t||this._prefix)+"_"+e)}catch(r){console.error(r)}},e.prototype.remove=function(e,t){try{localStorage.removeItem((t||this._prefix)+"_"+e)}catch(r){console.error(r)}},e.prototype.clear=function(){try{localStorage.clear()}catch(e){console.error(e)}},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[s]}]}]},e.ngInjectableDef=o.defineInjectable({factory:function(){return new e(o.inject(s))},token:e,providedIn:"root"}),e}(),c=function(){function e(){var t=this;this._eventStream=new n.BehaviorSubject(null),n.fromEvent(window,"storage").subscribe(function(e){return t._eventStream.next(e)})}return Object.defineProperty(e.prototype,"stream",{get:function(){return this._eventStream.asObservable().pipe(l.filter(function(e){return!!e}),l.share())},enumerable:!0,configurable:!0}),e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=o.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),f=function(){function e(e,t,r){var n=this;this.er=e,this.lss=t,this.es=r,this.lsDebounce=0,this.lsInitFromStorage=!1,this.lsStoredValue=new o.EventEmitter,this._valuePath=[],this.es.stream.pipe(l.filter(function(e){return 0<=e.key.indexOf(n.lsKey)})).subscribe(function(e){i(n._valuePath.length?n._valuePath:["value"],e.newValue,n.er.nativeElement,n.lsFalsyTransformer)})}return e.prototype.ngAfterViewInit=function(){this._initKey(),this._initFromStorage(),this._hookEvent()},Object.defineProperty(e.prototype,"lsValuePath",{set:function(e){this._valuePath=null!=e?Array.isArray(e)?e:e.split(","):[]},enumerable:!0,configurable:!0}),e.prototype._initKey=function(){if(!this.lsKey){if(!this.er.nativeElement.id&&!this.er.nativeElement.name)throw new Error("No key or element id or name supplied!");this.lsKey=this.er.nativeElement.id||this.er.nativeElement.name}},e.prototype._hookEvent=function(){var r=this;this.lsEvent&&(this._eventSubscription=n.fromEvent(this.er.nativeElement,this.lsEvent).pipe(l.debounceTime(this.lsDebounce)).subscribe(function(){var e,t;r.lss.asPromisable().set(r.lsKey,(e=r._valuePath.length?r._valuePath:["value"],t=r.er.nativeElement,e.reduce(function(e,t){return e?e[t]:null},t)),r.lsPrefix).then(function(){r.lss.asPromisable().get(r.lsKey,r.lsPrefix).then(function(e){r.lsStoredValue.emit(e)})["catch"](function(e){return console.error(e)})})["catch"](function(e){return console.error(e)})}))},e.prototype._initFromStorage=function(){var t=this;this.lsInitFromStorage&&this.lss.asPromisable().get(this.lsKey,this.lsPrefix).then(function(e){i(t._valuePath.length?t._valuePath:["value"],e,t.er.nativeElement,t.lsFalsyTransformer)})["catch"](function(e){return console.error(e)})},e.prototype.ngOnDestroy=function(){this._eventSubscription&&!this._eventSubscription.closed&&this._eventSubscription.unsubscribe()},e.decorators=[{type:o.Directive,args:[{selector:"[ngxLocalStorage]"}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:u},{type:c}]},e.propDecorators={lsKey:[{type:o.Input,args:["ngxLocalStorage"]}],lsPrefix:[{type:o.Input}],lsEvent:[{type:o.Input}],lsDebounce:[{type:o.Input}],lsInitFromStorage:[{type:o.Input}],lsFalsyTransformer:[{type:o.Input}],lsStoredValue:[{type:o.Output}],lsValuePath:[{type:o.Input}]},e}();function p(e){return new u(e)}var h=function(){function t(e){if(e)throw new Error("NgxLocalStorageModule is already loaded. Import it in the AppModule only")}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:s,useValue:e},{provide:u,useFactory:p,deps:[s]},c]}},t.decorators=[{type:o.NgModule,args:[{imports:[],declarations:[f],exports:[f]}]}],t.ctorParameters=function(){return[{type:t,decorators:[{type:o.Optional},{type:o.SkipSelf}]}]},t}();e.LocalStorageService=u,e.StorageEventService=c,e.LocalStorageDirective=f,e.ngxLocalStorage=function y(i){return function(t,r){var n=new u({prefix:i&&i.prefix?i.prefix:""}),o=i&&i.key?i.key:r;(new c).stream.pipe(l.filter(function(e){return 0<=e.key.indexOf(o)})).subscribe(function(e){e.newValue&&"string"==typeof e.newValue&&("null"!==e.newValue?t[r]=e.newValue:t[r]=i.nullTransformer?i.nullTransformer():null)}),Object.defineProperty(t,r,{get:function(){var e=n.get(o);return null==e&&i.nullTransformer?i.nullTransformer():e},set:function(e){n.set(o,e)}})}},e.provideStorageService=p,e.NgxLocalStorageModule=h,e.Éµa=s,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-localstorage.umd.min.js.map
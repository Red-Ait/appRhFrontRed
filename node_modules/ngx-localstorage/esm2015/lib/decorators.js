/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * Created by bohoffi on 22.05.2017.
 */
import { filter } from 'rxjs/operators';
import { LocalStorageService } from './services/ngx-localstorage.service';
import { StorageEventService } from './services/storage-event.service';
/**
 * @param {?=} options
 * @return {?}
 */
export function ngxLocalStorage(options) {
    return function (target, propertyDescription) {
        /** @type {?} */
        const service = new LocalStorageService({
            prefix: !!options && !!options.prefix ? options.prefix : ''
        });
        /** @type {?} */
        const key = !!options && !!options.key ? options.key : propertyDescription;
        /** @type {?} */
        const eventService = new StorageEventService();
        eventService.stream.pipe(
        // TODO: filter should be more accurate
        filter((ev) => ev.key.indexOf(key) >= 0))
            .subscribe((ev) => {
            if (!!ev.newValue && typeof ev.newValue === 'string') {
                if (ev.newValue !== 'null') {
                    target[propertyDescription] = ev.newValue;
                }
                else {
                    target[propertyDescription] = !!options.nullTransformer ? options.nullTransformer() : null;
                }
            }
        });
        Object.defineProperty(target, propertyDescription, {
            get: function () {
                /** @type {?} */
                const storageValue = service.get(key);
                return storageValue == null && !!options.nullTransformer ? options.nullTransformer() : storageValue;
            },
            set: function (value) {
                service.set(key, value);
            }
        });
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9ycy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1sb2NhbHN0b3JhZ2UvIiwic291cmNlcyI6WyJsaWIvZGVjb3JhdG9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBR0EsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBR3RDLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLHFDQUFxQyxDQUFDO0FBQ3hFLE9BQU8sRUFBQyxtQkFBbUIsRUFBQyxNQUFNLGtDQUFrQyxDQUFDOzs7OztBQUVyRSxNQUFNLFVBQVUsZUFBZSxDQUFDLE9BQXVCO0lBQ3JELE9BQU8sVUFBVSxNQUFjLEVBQUUsbUJBQTJCOztjQUVwRCxPQUFPLEdBQXdCLElBQUksbUJBQW1CLENBQUM7WUFDM0QsTUFBTSxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7U0FDNUQsQ0FBQzs7Y0FFSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsbUJBQW1COztjQUVwRSxZQUFZLEdBQXdCLElBQUksbUJBQW1CLEVBQUU7UUFDbkUsWUFBWSxDQUFDLE1BQU0sQ0FBQyxJQUFJO1FBQ3RCLHVDQUF1QztRQUN2QyxNQUFNLENBQUMsQ0FBQyxFQUFnQixFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FDdkQ7YUFDRSxTQUFTLENBQUMsQ0FBQyxFQUFnQixFQUFFLEVBQUU7WUFDOUIsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsSUFBSSxPQUFPLEVBQUUsQ0FBQyxRQUFRLEtBQUssUUFBUSxFQUFFO2dCQUNwRCxJQUFJLEVBQUUsQ0FBQyxRQUFRLEtBQUssTUFBTSxFQUFFO29CQUMxQixNQUFNLENBQUMsbUJBQW1CLENBQUMsR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDO2lCQUMzQztxQkFBTTtvQkFDTCxNQUFNLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7aUJBQzVGO2FBQ0Y7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVMLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLG1CQUFtQixFQUFFO1lBQ2pELEdBQUcsRUFBRTs7c0JBQ0csWUFBWSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO2dCQUNyQyxPQUFPLFlBQVksSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO1lBQ3RHLENBQUM7WUFDRCxHQUFHLEVBQUUsVUFBVSxLQUFVO2dCQUN2QixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMxQixDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGJvaG9mZmkgb24gMjIuMDUuMjAxNy5cclxuICovXHJcbmltcG9ydCB7ZmlsdGVyfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcblxyXG5pbXBvcnQge0RlY29yYXRvck9wdHN9IGZyb20gJy4vaW50ZXJmYWNlcyc7XHJcbmltcG9ydCB7TG9jYWxTdG9yYWdlU2VydmljZX0gZnJvbSAnLi9zZXJ2aWNlcy9uZ3gtbG9jYWxzdG9yYWdlLnNlcnZpY2UnO1xyXG5pbXBvcnQge1N0b3JhZ2VFdmVudFNlcnZpY2V9IGZyb20gJy4vc2VydmljZXMvc3RvcmFnZS1ldmVudC5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBuZ3hMb2NhbFN0b3JhZ2Uob3B0aW9ucz86IERlY29yYXRvck9wdHMpIHtcclxuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldDogT2JqZWN0LCBwcm9wZXJ0eURlc2NyaXB0aW9uOiBzdHJpbmcpIHtcclxuXHJcbiAgICBjb25zdCBzZXJ2aWNlOiBMb2NhbFN0b3JhZ2VTZXJ2aWNlID0gbmV3IExvY2FsU3RvcmFnZVNlcnZpY2Uoe1xyXG4gICAgICBwcmVmaXg6ICEhb3B0aW9ucyAmJiAhIW9wdGlvbnMucHJlZml4ID8gb3B0aW9ucy5wcmVmaXggOiAnJ1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3Qga2V5ID0gISFvcHRpb25zICYmICEhb3B0aW9ucy5rZXkgPyBvcHRpb25zLmtleSA6IHByb3BlcnR5RGVzY3JpcHRpb247XHJcblxyXG4gICAgY29uc3QgZXZlbnRTZXJ2aWNlOiBTdG9yYWdlRXZlbnRTZXJ2aWNlID0gbmV3IFN0b3JhZ2VFdmVudFNlcnZpY2UoKTtcclxuICAgIGV2ZW50U2VydmljZS5zdHJlYW0ucGlwZShcclxuICAgICAgLy8gVE9ETzogZmlsdGVyIHNob3VsZCBiZSBtb3JlIGFjY3VyYXRlXHJcbiAgICAgIGZpbHRlcigoZXY6IFN0b3JhZ2VFdmVudCkgPT4gZXYua2V5LmluZGV4T2Yoa2V5KSA+PSAwKVxyXG4gICAgKVxyXG4gICAgICAuc3Vic2NyaWJlKChldjogU3RvcmFnZUV2ZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKCEhZXYubmV3VmFsdWUgJiYgdHlwZW9mIGV2Lm5ld1ZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgaWYgKGV2Lm5ld1ZhbHVlICE9PSAnbnVsbCcpIHtcclxuICAgICAgICAgICAgdGFyZ2V0W3Byb3BlcnR5RGVzY3JpcHRpb25dID0gZXYubmV3VmFsdWU7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0YXJnZXRbcHJvcGVydHlEZXNjcmlwdGlvbl0gPSAhIW9wdGlvbnMubnVsbFRyYW5zZm9ybWVyID8gb3B0aW9ucy5udWxsVHJhbnNmb3JtZXIoKSA6IG51bGw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBwcm9wZXJ0eURlc2NyaXB0aW9uLCB7XHJcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbnN0IHN0b3JhZ2VWYWx1ZSA9IHNlcnZpY2UuZ2V0KGtleSk7XHJcbiAgICAgICAgcmV0dXJuIHN0b3JhZ2VWYWx1ZSA9PSBudWxsICYmICEhb3B0aW9ucy5udWxsVHJhbnNmb3JtZXIgPyBvcHRpb25zLm51bGxUcmFuc2Zvcm1lcigpIDogc3RvcmFnZVZhbHVlO1xyXG4gICAgICB9LFxyXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgc2VydmljZS5zZXQoa2V5LCB2YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcbn1cclxuIl19